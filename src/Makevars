# Static linking and includes for TileDBVCF (no-configure mode)
# Use absolute paths since configure step is skipped

# Get absolute path to package directory
PKG_ROOT := ..
TILEDBVCF_DIR := $(PKG_ROOT)/inst/TileDBVCF
OBJS = src/RC_TileDBvcf.o
# Get vcfppR HTSLib paths
VCFPPR_INCLUDE := $(shell "${R_HOME}/bin/R" --slave --vanilla -e "cat(system.file('include', package='vcfppR'))")
VCFPPR_LIBS := $(shell "${R_HOME}/bin/R" --slave --vanilla -e "cat(system.file('libs', package='vcfppR'))")

# Check if TileDB-VCF libraries exist
ifeq ($(wildcard $(TILEDBVCF_DIR)/lib/libtiledbvcf.so),)
$(error TileDB-VCF libraries not found. Run ./configure first to build them.)
endif


PKG_CPPFLAGS = -I$(TILEDBVCF_DIR)/include -I$(VCFPPR_INCLUDE)
PKG_CFLAGS = -fPIC -I$(TILEDBVCF_DIR)/include -I$(VCFPPR_INCLUDE)
PKG_LIBS = -L$(TILEDBVCF_DIR)/lib \
  $(TILEDBVCF_DIR)/lib/libtiledbvcf.so $(TILEDBVCF_DIR)/lib/libtiledb.so.2.28 \
  $(TILEDBVCF_DIR)/lib/libhts.so.1.22.1 -Wl,-rpath,'$$ORIGIN' -Wl,-rpath,'$$ORIGIN/../TileDBVCF/lib' \
  -lz -lm -lbz2 -llzma -lcurl -ldeflate

all: $(SHLIB)

.PHONY: all clean $(OBJS) 

clean:
	@rm -rf  src/libtiledbvcf/build